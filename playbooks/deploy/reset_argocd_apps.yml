- name: Reset ArgoCD Applications (Delete & Re-apply)
  hosts: K8S_Primary_Master
  gather_facts: no
  become: yes
  tasks:
    - name: Copy argocd_apps.yaml to Master Node
      copy:
        src: "{{ playbook_dir }}/../../k8s_manifests/argocd/argocd_apps.yaml"
        dest: /root/argocd_apps.yaml

    - name: Delete existing ArgoCD Applications
      shell: kubectl delete -f /root/argocd_apps.yaml --ignore-not-found=true
      register: delete_result
    
    - name: Debug delete result
      debug:
        msg: "{{ delete_result.stdout_lines }}"

    - name: Wait for deletion (15s)
      pause:
        seconds: 15

    - name: Apply ArgoCD Applications Fresh
      shell: kubectl apply -f /root/argocd_apps.yaml
      register: apply_result

    - name: Display Apply Result
      debug:
        msg: "{{ apply_result.stdout_lines }}"
